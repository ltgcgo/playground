!function(){"use strict";const n={debug:!1,parse:function(e,t){if(e instanceof Uint8Array)return n.Uint8(e);if("string"==typeof e)return n.Base64(e);if(e instanceof HTMLElement&&"file"===e.type)return n.addListener(e,t);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(e,r){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(void 0===e||!(e instanceof HTMLElement)||"INPUT"!==e.tagName||"file"!==e.type.toLowerCase())return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;r=r||function(){},e.addEventListener("change",function(e){if(!e.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let t=new FileReader;t.readAsArrayBuffer(e.target.files[0]),t.onload=function(e){r(n.Uint8(new Uint8Array(e.target.result)))}})},Base64:function(e){let t=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(e=e.replace(/^.*?base64,/,""),e=String(e).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(e))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");e+="==".slice(2-(3&e.length));let r,a="",n,i,d=0;for(;d<e.length;)r=t.indexOf(e.charAt(d++))<<18|t.indexOf(e.charAt(d++))<<12|(n=t.indexOf(e.charAt(d++)))<<6|(i=t.indexOf(e.charAt(d++))),a+=64===n?String.fromCharCode(r>>16&255):64===i?String.fromCharCode(r>>16&255,r>>8&255):String.fromCharCode(r>>16&255,r>>8&255,255&r);return a}(e=String(e));var r=t.length;let a=new Uint8Array(new ArrayBuffer(r));for(let e=0;e<r;e++)a[e]=t.charCodeAt(e);return n.Uint8(a)},Uint8:function(e){let i={data:null,pointer:0,movePointer:function(e){return this.pointer+=e,this.pointer},readInt:function(t){if((t=Math.min(t,this.data.byteLength-this.pointer))<1)return-1;let r=0;if(1<t)for(let e=1;e<=t-1;e++)r+=this.data.getUint8(this.pointer)*Math.pow(256,t-e),this.pointer++;return r+=this.data.getUint8(this.pointer),this.pointer++,r},readStr:function(t){let r="";for(let e=1;e<=t;e++)r+=String.fromCharCode(this.readInt(1));return r},backOne:function(){this.pointer--;},readIntVLV:function(){let r=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)r=this.readInt(1);else{let t=[];for(;128<=this.data.getUint8(this.pointer);)t.push(this.readInt(1)-128);var e=this.readInt(1);for(let e=1;e<=t.length;e++)r+=t[t.length-e]*Math.pow(128,e);r+=e}return r}};if(i.data=new DataView(e.buffer,e.byteOffset,e.byteLength),1297377380!==i.readInt(4))return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;i.readInt(4);let d={};d.formatType=i.readInt(2),d.tracks=i.readInt(2),d.track=[];var e=i.readInt(1),t=i.readInt(1);128<=e?(d.timeDivision=[],d.timeDivision[0]=e-128,d.timeDivision[1]=t):d.timeDivision=256*e+t;for(let n=1;n<=d.tracks;n++){d.track[n-1]={event:[]};var s,o=i.readInt(4);if(-1===o)break;if(1297379947!==o)return!1;i.readInt(4);let e=0,t=!1,r,a;for(;!t&&(e++,d.track[n-1].event[e-1]={},d.track[n-1].event[e-1].deltaTime=i.readIntVLV(),-1!==(r=i.readInt(1)));)if(128<=r?a=r:(r=a,i.movePointer(-1)),255===r){d.track[n-1].event[e-1].type=255,d.track[n-1].event[e-1].metaType=i.readInt(1);var c=i.readIntVLV();switch(d.track[n-1].event[e-1].metaType){case 47:case-1:t=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:d.track[n-1].event[e-1].data=i.readStr(c);break;case 33:case 89:case 81:d.track[n-1].event[e-1].data=i.readInt(c);break;case 84:d.track[n-1].event[e-1].data=[],d.track[n-1].event[e-1].data[0]=i.readInt(1),d.track[n-1].event[e-1].data[1]=i.readInt(1),d.track[n-1].event[e-1].data[2]=i.readInt(1),d.track[n-1].event[e-1].data[3]=i.readInt(1),d.track[n-1].event[e-1].data[4]=i.readInt(1);break;case 88:d.track[n-1].event[e-1].data=[],d.track[n-1].event[e-1].data[0]=i.readInt(1),d.track[n-1].event[e-1].data[1]=i.readInt(1),d.track[n-1].event[e-1].data[2]=i.readInt(1),d.track[n-1].event[e-1].data[3]=i.readInt(1);break;default:null!==this.customInterpreter&&(d.track[n-1].event[e-1].data=this.customInterpreter(d.track[n-1].event[e-1].metaType,i,c)),null!==this.customInterpreter&&!1!==d.track[n-1].event[e-1].data||(i.readInt(c),d.track[n-1].event[e-1].data=i.readInt(c),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((r=r.toString(16).split(""))[1]||r.unshift("0"),d.track[n-1].event[e-1].type=parseInt(r[0],16),d.track[n-1].event[e-1].channel=parseInt(r[1],16),d.track[n-1].event[e-1].type){case 15:null!==this.customInterpreter&&(d.track[n-1].event[e-1].data=this.customInterpreter(d.track[n-1].event[e-1].type,i,!1)),null!==this.customInterpreter&&!1!==d.track[n-1].event[e-1].data||(s=i.readIntVLV(),d.track[n-1].event[e-1].data=i.readInt(s),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:d.track[n-1].event[e-1].data=[],d.track[n-1].event[e-1].data[0]=i.readInt(1),d.track[n-1].event[e-1].data[1]=i.readInt(1);break;case 12:case 13:d.track[n-1].event[e-1].data=i.readInt(1);break;case-1:t=!0;break;default:if(null!==this.customInterpreter&&(d.track[n-1].event[e-1].data=this.customInterpreter(d.track[n-1].event[e-1].metaType,i,!1)),null===this.customInterpreter||!1===d.track[n-1].event[e-1].data)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return d},customInterpreter:null};if("undefined"!=typeof module)module.exports=n;else{let e="object"==typeof window&&window.self===window&&window||"object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;e.MidiParser=n}}();